<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <title>anttask - Yeti API documentation </title>
    <style type="text/css">

    body{
         font-family: "Lucida Grande","Trebuchet MS","Bitstream Vera Sans",Verdana,Helvetica,sans-serif;font-size: 14px;
         line-height: 18px;
    }

    h4 {
        margin: 0;
    }

    p {
        margin-top: 3px;
    }

    ul {
        list-style: none;
        margin: 0;
        padding:0;
    }

    body{
        margin:0;
        padding:0;
        line-height: 1.5em;
    }

    b{font-size: 110%;}
    em{color: red;}
    .var-marker {font-size: 80%; color: #666;}
    .struct-marker {font-size: 60%; color: #666;}

    pre.doc {
         font-family: "Lucida Grande","Trebuchet MS","Bitstream Vera Sans",Verdana,Helvetica,sans-serif;font-size: 14px;
         line-height: 18px;
    }

    pre.type {
        white-space: pre-wrap;
        white-space: -moz-pre-wrap;
        white-space: -o-pre-wrap;
        background: #faf8f0;
    }

    code {
        display: block;
        padding: 0.5em 1em;
        border: 1px solid #bebab0;
    }
    div.codeheader {
        margin-bottom: 0;
        padding-bottom: 0;
    }
    pre.codeheader {
        margin-top: 3px;
    }

    #topsection{
        background: #EAEAEA;
        height: 90px; /*Height of top section*/
    }

    #topsection h1{
        margin: 0;
        padding-top: 15px;
    }

    #contentwrapper{
        float: left;
        width: 100%;
    }

    #contentcolumn{
        margin-left: 200px; /*Set left margin to LeftColumnWidth*/
        border-left: 5px solid  #EAEAEA;
    }

    #leftcolumn{
        float: left;
        width: 200px; /*Width of left column*/
        margin-left: -100%;
        margin-top: 15px;
        
        /*background: #C8FC98;*/
    }

    #footer{
        clear: left;
        width: 100%;
        background: black;
        color: #FFF;
        text-align: center;
        padding: 4px 0;
    }

    #footer a{
        color: #FFFF80;
    }

    .innertube{
        margin: 10px; /*Margins for inner DIV inside each column (to provide padding)*/
        margin-top: 0;
    }

    </style>


</head>
<body>
<div id="maincontainer">
    <div id="topsection"><div class="innertube">
        <h1>Yeti API documentation </h1>
        <h2>anttask</h2>
    </div></div>

    <div id="contentwrapper"><div id="contentcolumn"><div class="innertube">
                <h1>yeti.lang.compiler.repl</h1>
        <a href="#source">sourcecode</a>
        <h2>Overview</h2>
        <pre class="doc">
 * Yeti compiler and REPL interface.
 * Copyright (c) 2008.2009 Madis Janson
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR &#34;AS IS&#34; AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */</pre>
         <h2>Module Type</h2>
         <pre class="type"><code>array&#60;string&#62; -&#62; {
   var classPath is list&#60;string&#62;,
   compilationOf is ~yeti.lang.compiler.CodeWriter -&#62; ~yeti.lang.compiler.CompileCtx,
   var evalContext is ~yeti.lang.compiler.YetiEval,
   evaluate is string -&#62; number -&#62; string,
   execClass is boolean -&#62; ~java.lang.ClassLoader -&#62; ~java.lang.Object,
   var gcj is boolean,
   getTrace is ~java.lang.Throwable -&#62; string,
   var mainClass is string,
   var noframes is boolean,
   var preload is list&#60;string&#62;,
   reader is ~yeti.lang.compiler.YetiC,
   var sandbox is boolean
}</code></pre>

        <h2><a name="source">Source</a></h2>
        <pre class="type"><code>/**
 * Yeti compiler and REPL interface.
 * Copyright (c) 2008.2009 Madis Janson
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR &#34;AS IS&#34; AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
module yeti.lang.compiler.repl;

import java.lang: Class, ClassLoader;
import yeti.lang.Core;
import java.security.Permission;
import java.io.File;

do argv: {
    var preload = [&#34;yeti/lang/std&#34;, &#34;yeti/lang/io&#34;],
    var mainClass = &#34;code&#34;,
    var classPath = [],
    var sandbox = false,
    var gcj = false,
    var noframes = false,
    var evalContext = () as ~YetiEval,
    reader = new YetiC(),

    compilationOf writer =
        ctx = new CompileCtx(reader, writer, preload,
                             new ClassFinder(classPath as ~String[]));
        if gcj then
            ctx#isGCJ := true
        fi;
        if noframes then
            ctx#classWriterFlags := 0
        fi;
        ctx,

    getTrace ex is ~java.lang.Throwable -&#62; string =
        sw = new java.io.StringWriter();
        ex#printStackTrace(new java.io.PrintWriter(sw));
        sw#toString(),

    execClass eval writer =
        c = Class#forName(strReplace '/' '.' mainClass, true, writer);
        try
            if eval then
                f = c#newInstance() unsafely_as () -&#62; 'a;
                if sandbox then
                    var sandboxed = \();
                    class Sandbox extends java.lang.SecurityManager
                        void checkPermission(Permission perm)
                            sandboxed (),
                        void checkPermission(Permission perm, Object context)
                            sandboxed (),
                        void checkExit(int status)
                            ()
                    end;
                    System#setSecurityManager(new Sandbox());
                    // can't activate before, because
                    // setSecurityManager would fail otherwise
                    sandboxed := \throw new java.lang.SecurityException();
                fi;
                f ()
            else
                aa = new Object[1];
                aa.[0] := argv is array&#60;string&#62; as ~String[] as ~Object;
                c#getMethod(&#34;main&#34;, [classOf String[]])#invoke((), aa)
            fi
        catch java.lang.reflect.InvocationTargetException ex:
            t = ex#getCause();
            throw if defined? t then t else ex fi;
        yrt,

    evaluate line flags =
        writer = new Loader();
        res = array [];
        oldContext = YetiEval#get();
        if defined? evalContext or not defined? oldContext then
            if not defined? evalContext then
                evalContext := new YetiEval()
            fi;
            YetiEval#set(evalContext)
        fi;
        try
            bindings = YetiEval#get()#bindings;
            bindBarrier = bindings#size();
            compilation = compilationOf writer;
            type_ = compilation#compile((), mainClass, line is string, flags +
                                            YetiC#CF_EVAL + YetiC#CF_EVAL_BIND);
            try
                val = execClass true writer;
                if type_#deref()#type != YetiType#UNIT then
                    push res &#34;\(Core#show(val)) is \(type_)&#34;
                fi
            catch Exception ex:
                push res (getTrace ex)
            catch java.lang.StackOverflowError ex:
                push res (getTrace ex)
            yrt;
            for [bindBarrier .. bindings#size() - 1] do i:
                binding = bindings#get(i) unsafely_as ~YetiEval$Binding;
                if not binding#isImport then
                    t = binding#type;
                    push res &#34;\(if binding#mutable then &#34;var &#34; else &#34;&#34; fi)\
                             &#34;\(binding#name) is \(t) = \
                             &#34;\(if t#deref()#type == YetiType#UNIT then
                                    &#34;()&#34;
                                elif nullptr? binding#value then
                                    &#34;&#60;undef&#62;&#34;
                                else
                                    Core#show(binding#val())
                                fi)&#34;
                fi
            done
        catch CompileException ex:
            push res ex#getMessage()
        finally
            YetiEval#set(oldContext)
        yrt;
        strJoin '' (map (^ &#34;\n&#34;) res),

    /* deprecated
    compileToFiles sources target printMessage
            is list?&#60;string&#62; -&#62; string -&#62; (~CompileException -&#62; ()) -&#62; boolean =
        target = if target == &#34;&#34; then &#34;&#34; else target ^ File#separator fi;
        compilation = compilationOf new ToFile(target);
        try
            for sources do src:
                mainClass := compilation#compile(src, 0)
            done;
            compilation#enumWarns(printMessage);
            true
        catch CompileException ex:
            compilation#enumWarns(printMessage);
            printMessage ex;
            false
        yrt*/
} done
</code></pre>

    </div></div></div>

    <div id="leftcolumn"><div class="innertube">
        <!--<b>Left Column: <em>200px</em></b> <script type="text/javascript">filltext(15)</script> -->
               <h4>modules</h4>
        <ul><li><a href="yeti$lang$std.html">yeti.lang.std</a></li>
             <li><a href="yeti$lang$compiler$repl.html">yeti.lang.compiler.repl</a></li>
             <li><a href="yeti$http.html">yeti.http</a></li>
             <li><a href="std.html">std</a></li>
             <li><a href="some1.html">some1</a></li>
             <li><a href="some.html">some</a></li></ul>

    </div></div>

    <div id="footer">
        <a href="http://mth.github.com/yeti/">Yeti - home</a>
    </div>
</div>
</body>
</html>
